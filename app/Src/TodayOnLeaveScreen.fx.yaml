TodayOnLeaveScreen As screen:
    Fill: |
        =RGBA(255,255,255,1)
    Height: =Max(App.Height, App.DesignHeight)
    OnHidden: =Set(_showDetails, false)
    OnVisible: |-
        =Concurrent(
            Set(_navMenuSelect, "My Leave Requests"),
            //if not manager view, refresh my balance collection when on this screen
            If(!_managerView, Set(_requesterBalanceRecord, LookUp(BalanceCollection, Year = Text(Year(Now())) && EmployeeEmail = _myProfile.UserPrincipalName));
                ClearCollect(RequesterBalanceCollection, 
                { type: "Vacation", balance: Value(_requesterBalanceRecord.Vacation) - Value(_requesterBalanceRecord.VacationUsed)},
                {type:"Sick Leave", balance:Value(_requesterBalanceRecord.Sick)-Value(_requesterBalanceRecord.SickUsed)},
                {type:"Floating Holiday", balance:Value(_requesterBalanceRecord.Floating)-Value(_requesterBalanceRecord.FloatingUsed)},
                {type:"Jury Duty", balance:Value(_requesterBalanceRecord.JuryDuty)-Value(_requesterBalanceRecord.JuryDutyUsed)},
                {type:"Bereavement", balance:Value(_requesterBalanceRecord.Bereavement)-Value(_requesterBalanceRecord.BereavementUsed)})
            ),
            Set(_showDetails, false)
        );
    Orientation: =If(TodayOnLeaveScreen.Width < TodayOnLeaveScreen.Height, Layout.Vertical, Layout.Horizontal)
    Size: =1 + CountRows(App.SizeBreakpoints) - CountIf(App.SizeBreakpoints, Value >= TodayOnLeaveScreen.Width)
    Width: =Max(App.Width, App.DesignWidth)

    GalleryNavigation_8 As gallery.galleryVertical:
        AccessibleLabel: ="Select a gallery item to navigate to it's respective page"
        DisabledBorderColor: =GalleryNavigation_8.BorderColor
        DisabledFill: =GalleryNavigation_8.Fill
        Fill: =RGBA(249, 249, 249, 1)
        Height: =688
        HoverBorderColor: =GalleryNavigation_8.BorderColor
        HoverFill: =GalleryNavigation_8.Fill
        Items: |
            =If(_managerView, ManagerNavigation, EmployeeNavigation)
        Layout: =Layout.Vertical
        LoadingSpinnerColor: =GalleryNavigation_8.BorderColor
        OnSelect: |-
            =Set(_navMenuSelect, ThisItem.MenuItem);
            If(
                "Requests" in ThisItem.MenuItem, Navigate(TodayOnLeaveScreen, BorderStyle.None),
                "Balance" in ThisItem.MenuItem, Navigate(LeaveBalanceScreen, BorderStyle.None),
                "Holidays" in ThisItem.MenuItem, Navigate(CompanyHolidaysScreen, BorderStyle.None),
                ThisItem.MenuItem = "About", Navigate(AboutScreen, BorderStyle.None),
                ThisItem.MenuItem = "Log out", Navigate(LoginScreen, BorderStyle.None)
            )
        PressedBorderColor: =GalleryNavigation_8.BorderColor
        PressedFill: =GalleryNavigation_8.Fill
        ShowScrollbar: =false
        TemplateFill: =If(ThisItem.MenuItem = _navMenuSelect, RGBA(255,255,255,1), RGBA(245,245,245,1))
        TemplatePadding: =0
        TemplateSize: =72
        Width: =231
        Y: =80
        ZIndex: =1

        LeftMenuSeparator_8 As rectangle:
            AccessibleLabel: =ThisItem.MenuItem
            DisabledFill: =LeftMenuSeparator_8.Fill
            Fill: =RGBA(205, 205, 205, 1)
            FocusedBorderColor: =LeftMenuSeparator_8.BorderColor
            Height: =1
            HoverFill: =LeftMenuSeparator_8.Fill
            OnSelect: =Select(Parent)
            PressedFill: =LeftMenuSeparator_8.Fill
            Width: =GalleryNavigation_8.TemplateWidth
            Y: =Parent.TemplateHeight - LeftMenuSeparator_8.Height
            ZIndex: =1

        Label2_8 As label:
            Align: =TextPosition.Left
            Color: =If(ThisItem.MenuItem = _navMenuSelect, RGBA(47,41,43,1), RGBA(10,100,204,1))
            FocusedBorderColor: =Label2_8.BorderColor
            FocusedBorderThickness: =2
            Font: =Font.Lato
            FontWeight: =FontWeight.Bold
            Height: =72
            HoverBorderColor: =Label2_8.BorderColor
            HoverColor: =Label2_8.Color
            HoverFill: =Label2_8.Fill
            OnSelect: =Select(Parent)
            PaddingLeft: =30
            PressedBorderColor: =Label2_8.BorderColor
            PressedColor: =Label2_8.Color
            PressedFill: =Label2_8.Fill
            Size: =13.5
            TabIndex: =0
            Text: =ThisItem.MenuItem
            Width: =231
            ZIndex: =2

    Header_6 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =11

        Rectangle1_6 As rectangle:
            DisabledFill: =Rectangle1_6.Fill
            Fill: =RGBA(0, 71, 144, 1)
            FocusedBorderColor: =Rectangle1_6.BorderColor
            Height: =80
            HoverFill: =Rectangle1_6.Fill
            PressedFill: =Rectangle1_6.Fill
            Width: =1366
            ZIndex: =4

        LblHeaderTItle1_6 As label:
            Color: =RGBA(255, 255, 255, 1)
            FocusedBorderColor: =LblHeaderTItle1_6.BorderColor
            Font: =Font.Lato
            Height: =80
            HoverBorderColor: =LblHeaderTItle1_6.BorderColor
            HoverColor: =LblHeaderTItle1_6.Color
            HoverFill: =LblHeaderTItle1_6.Fill
            PressedBorderColor: =LblHeaderTItle1_6.BorderColor
            PressedColor: =LblHeaderTItle1_6.Color
            PressedFill: =LblHeaderTItle1_6.Fill
            Size: =18
            Text: =Upper("Request")
            Width: =117
            X: =30
            ZIndex: =5

        LblHeaderTitle2_6 As label:
            Color: =RGBA(255, 255, 255, 1)
            FocusedBorderColor: =LblHeaderTitle2_6.BorderColor
            Height: =80
            HoverBorderColor: =LblHeaderTitle2_6.BorderColor
            HoverColor: =LblHeaderTitle2_6.Color
            HoverFill: =LblHeaderTitle2_6.Fill
            PressedBorderColor: =LblHeaderTitle2_6.BorderColor
            PressedColor: =LblHeaderTitle2_6.Color
            PressedFill: =LblHeaderTitle2_6.Fill
            Size: =18
            Text: =Upper("Leave")
            Width: =138
            X: =178
            ZIndex: =6

        icon2_6 As icon.ArrowRight:
            Color: =Color.White
            DisabledFill: =icon2_6.Fill
            FocusedBorderColor: =icon2_6.BorderColor
            HoverBorderColor: =ColorFade(icon2_6.BorderColor, 20%)
            HoverColor: =ColorFade(icon2_6.Color, 20%)
            HoverFill: =icon2_6.Fill
            Icon: =Icon.ArrowRight
            PressedBorderColor: =ColorFade(icon2_6.BorderColor, -20%)
            PressedColor: =ColorFade(icon2_6.Color, -20%)
            PressedFill: =icon2_6.Fill
            Width: =32
            X: =143
            Y: =9
            ZIndex: =7

        CircleHeaderCreateNew_5 As circle:
            DisabledFill: =CircleHeaderCreateNew_5.Fill
            Fill: =Color.White
            FocusedBorderColor: =CircleHeaderCreateNew_5.BorderColor
            Height: =46
            HoverFill: =CircleHeaderCreateNew_5.Fill
            PressedFill: =CircleHeaderCreateNew_5.Fill
            Visible: =!_managerView
            Width: =46
            X: =1155
            Y: =17
            ZIndex: =8

        IconHeaderCreateNew_5 As icon.Add:
            AccessibleLabel: ="Create new leave request"
            Color: =Rectangle1_6.Fill
            DisabledFill: =IconHeaderCreateNew_5.Fill
            FocusedBorderColor: =IconHeaderCreateNew_5.BorderColor
            Height: =46
            HoverBorderColor: =ColorFade(IconHeaderCreateNew_5.BorderColor, 20%)
            HoverColor: =ColorFade(IconHeaderCreateNew_5.Color, 20%)
            HoverFill: =IconHeaderCreateNew_5.Fill
            Icon: =Icon.Add
            OnSelect: |
                =Set(_editingRequest, false);
                Set(_selectedLeaveType, Blank());
                Navigate(NewRequestScreen, BorderStyle.None)
            PaddingBottom: =7
            PaddingLeft: =7
            PaddingRight: =7
            PaddingTop: =7
            PressedBorderColor: =ColorFade(IconHeaderCreateNew_5.BorderColor, -20%)
            PressedColor: =ColorFade(IconHeaderCreateNew_5.Color, -20%)
            PressedFill: =IconHeaderCreateNew_5.Fill
            TabIndex: =
            Visible: =!_managerView
            Width: =46
            X: =CircleHeaderCreateNew_5.X
            Y: =CircleHeaderCreateNew_5.Y
            ZIndex: =9

        LblHeaderCreateNew_5 As label:
            Color: =RGBA(255, 255, 255, 1)
            FocusedBorderColor: =LblHeaderCreateNew_5.BorderColor
            FocusedBorderThickness: =02
            Font: =Font.Lato
            FontWeight: =FontWeight.Bold
            Height: =80
            HoverBorderColor: =LblHeaderCreateNew_5.BorderColor
            HoverColor: =LblHeaderCreateNew_5.Color
            HoverFill: =LblHeaderCreateNew_5.Fill
            OnSelect: =
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            PressedBorderColor: =LblHeaderCreateNew_5.BorderColor
            PressedColor: =LblHeaderCreateNew_5.Color
            PressedFill: =LblHeaderCreateNew_5.Fill
            Size: =13.5
            Text: ="Create Request"
            Visible: =!_managerView
            Width: =155
            X: =1211
            ZIndex: =10

    "GalleryRequests_1 As gallery.'BrowseLayout_Vertical_TwoTextVariant_ver4.0'":
        AccessibleLabel: ="Leave request gallery"
        Default: =Blank()
        DisabledBorderColor: =GalleryRequests_1.BorderColor
        DisabledFill: =GalleryRequests_1.Fill
        Height: =606
        HoverBorderColor: =GalleryRequests_1.BorderColor
        HoverFill: =GalleryRequests_1.Fill
        Items: |-
            =//Filter values based on _requestTypeFilter, set by selecting item in GalleryFilters. Sort by StartDate, descending.
            Sort(
                If(_requestTypeFilter="All",
                  Filter(LeaveCollection, If(_managerView, Approver = _myProfile.UserPrincipalName, Requester = _myProfile.UserPrincipalName)), 
                  Filter(LeaveCollection, Status=_requestTypeFilter && If(_managerView, Approver = _myProfile.UserPrincipalName, Requester = _myProfile.UserPrincipalName)) ), StartDate, SortOrder.Descending)
        Layout: =Layout.Vertical
        LoadingSpinnerColor: =GalleryRequests_1.BorderColor
        OnSelect: |-
            =Set(_selectedLeaveItem, ThisItem);
            
            If(_managerView, 
                //If manager view, get user's leave balance record and determine any overlaps this request has from other people I manage
                Set(_requesterBalanceRecord, LookUp(BalanceCollection, Year = Text(Year(Now())) && EmployeeEmail = ThisItem.Requester));
                ClearCollect(RequestOverlaps, Filter(LeaveCollection, EndDate >= _selectedLeaveItem.StartDate && StartDate <= _selectedLeaveItem.EndDate 
                && Requester <>_selectedLeaveItem.Requester));
                
                If(CountRows(RequestOverlaps) > 0, Set(_requestOverlapMessage, Concat(ForAll(Distinct(RequestOverlaps, Requester), {Result: ThisRecord.Value}), Result, ", ")))
            );
            
            Concurrent(
                //gather requester or approver info depending on view
                If(_managerView, 
                    Set(_requester, Office365Users.UserProfile(ThisItem.Requester)), 
                    Set(_selectedApprover, Office365Users.UserProfile(ThisItem.Approver)); If(Office365Users.UserPhotoMetadata(_selectedApprover.Id).HasPhoto, Set(_selectedApproverPhoto, Office365Users.UserPhoto(_selectedApprover.Id)))),
                //**** CALCULATION USED TO DETERMINE TOTAL WORK DAYS REQUESTED ****
                 Set(_inclusiveTotalDaysRequested, DateDiff(ThisItem.StartDate, ThisItem.EndDate, TimeUnit.Days) + 1);
                    Set(_numFullWeeks, RoundDown(_inclusiveTotalDaysRequested / 7, 0));
                    Set(_numFullDaysPartialWeek, _inclusiveTotalDaysRequested - _numFullWeeks * 7);
                    Set(_startWeekday, Weekday(ThisItem.StartDate)); 
                    Set(_endWeekday, Weekday(ThisItem.EndDate));
            
            
                   //calculates the number of business days in the partial week left over after whole weeks are subtracted out of total days requested
                If(_numFullDaysPartialWeek = 6, 
                    If(_startWeekday <= 2, Set(_numPartialWeekdays, 5), Set(_numPartialWeekdays, 4)
                    ),
                  _numFullDaysPartialWeek = 5,
                    If(_startWeekday = 2, Set(_numPartialWeekdays, 5), _startWeekday = 1 || _startWeekday = 3 || _startWeekday = 4, Set(_numPartialWeekdays, 4), Set(_numPartialWeekdays, 3)
                    ),
                  _numFullDaysPartialWeek = 4,
                    If(_startWeekday = 2 || _startWeekday = 3, Set(_numPartialWeekdays, 4), _startWeekday = 1 || _startWeekday = 4, Set(_numPartialWeekdays, 3), Set(_numPartialWeekdays, 2)
                    ),
                  _numFullDaysPartialWeek = 3,
                    If(_startWeekday = 6 || _startWeekday = 7, Set(_numPartialWeekdays, 1), _startWeekday = 1 || _startWeekday = 5, Set(_numPartialWeekdays, 2), Set(_numPartialWeekdays, 3)
                    ),
                  _numFullDaysPartialWeek = 2,
                    If(_startWeekday = 7, Set(_numPartialWeekdays, 0), _startWeekday = 1 || _startWeekday = 6, Set(_numPartialWeekdays, 1), Set(_numPartialWeekdays, 2)),
                  _numFullDaysPartialWeek = 1,
                    If(_startWeekday = 1 || _startWeekday = 7, Set(_numPartialWeekdays, 0), Set(_numPartialWeekdays, 1)
                    ),
                  _numFullDaysPartialWeek = 0, Set(_numPartialWeekdays, 0)
                );
                  Set(_workDaysInRequest, _numFullWeeks * 5 + _numPartialWeekdays),
                  Set(_holidaysInRequest, CountIf(HolidaysCollection, StartDate >= ThisItem.StartDate, StartDate <= ThisItem.EndDate))
            );
            Set(_requestedDays, _workDaysInRequest - _holidaysInRequest);
            //**** END CALCULATION ****
            Set(_showDetails, true);
        PressedBorderColor: =GalleryRequests_1.BorderColor
        PressedFill: =GalleryRequests_1.Fill
        ShowScrollbar: =false
        TemplateFill: =If(ThisItem.IsSelected, RGBA(249, 249, 249, 1))
        TemplateSize: =128
        Visible: =CountRows(GalleryRequests_1.AllItems) > 0
        Width: =775
        X: =232
        Y: =162
        ZIndex: =12

        Label3_1 As label:
            Color: =RGBA(10, 106, 204, 1)
            FocusedBorderColor: =Label3_1.BorderColor
            FocusedBorderThickness: =2
            Font: =Font.Lato
            FontWeight: =FontWeight.Bold
            Height: =Label3_1.Size * 1.7
            HoverBorderColor: =Label3_1.BorderColor
            HoverColor: =Label3_1.Color
            HoverFill: =Label3_1.Fill
            OnSelect: =Select(Parent)
            PressedBorderColor: =Label3_1.BorderColor
            PressedColor: =Label3_1.Color
            PressedFill: =Label3_1.Fill
            Size: =18
            Text: =ThisItem.Title
            Width: =620
            X: =6
            Y: =15
            ZIndex: =1

        Label5_1 As label:
            FocusedBorderColor: =Label5_1.BorderColor
            FocusedBorderThickness: =2
            Font: =Font.'Lato Light'
            Height: =Label5_1.Size * 1.8
            HoverBorderColor: =Label5_1.BorderColor
            HoverColor: =Label5_1.Color
            HoverFill: =Label5_1.Fill
            OnSelect: =Select(Parent)
            PressedBorderColor: =Label5_1.BorderColor
            PressedColor: =Label5_1.Color
            PressedFill: =Label5_1.Fill
            Size: =13.5
            Text: =Text(ThisItem.StartDate,"[$-en-US]dddd, mmm. dd, yyyy") & If(DateDiff(ThisItem.StartDate, ThisItem.EndDate, TimeUnit.Days) <> 0, " - " & Text(ThisItem.EndDate,"[$-en-US]dddd, mmm. dd, yyyy"))
            Width: =658
            X: =6
            Y: =57
            ZIndex: =2

        Label6_1 As label:
            FocusedBorderColor: =Label6_1.BorderColor
            FocusedBorderThickness: =2
            Font: =Font.Lato
            Height: =30
            HoverBorderColor: =Label6_1.BorderColor
            HoverColor: =Label6_1.Color
            HoverFill: =Label6_1.Fill
            OnSelect: =Select(Parent)
            PressedBorderColor: =Label6_1.BorderColor
            PressedColor: =Label6_1.Color
            PressedFill: =Label6_1.Fill
            Size: =10.5
            Text: =If(_managerView, ThisItem.Requester, ThisItem.Detail)
            Width: =381
            X: =6
            Y: =88
            ZIndex: =3

        RequestStatus_1 As button:
            BorderColor: =RequestStatus_1.Color
            Color: |-
                =If(Upper(ThisItem.Status)="PENDING",RGBA(0, 71, 144, 1),
                Upper(ThisItem.Status)="DECLINED",RGBA(213, 0, 0, 1),
                Upper(ThisItem.Status)="APPROVED",RGBA(0, 128, 0, 1))
            DisabledBorderColor: =ColorFade(RequestStatus_1.BorderColor, 70%)
            Fill: =RGBA(255, 255, 255, 1)
            FocusedBorderColor: =RequestStatus_1.BorderColor
            Font: =Font.Lato
            Height: =30
            HoverBorderColor: =RequestStatus_1.BorderColor
            HoverColor: =RequestStatus_1.Color
            HoverFill: =ColorFade(RequestStatus_1.Fill, 20%)
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            PressedBorderColor: =RequestStatus_1.BorderColor
            PressedColor: =RequestStatus_1.Fill
            PressedFill: =RequestStatus_1.Color
            RadiusBottomLeft: =4
            RadiusBottomRight: =4
            RadiusTopLeft: =4
            RadiusTopRight: =4
            Size: =10.5
            Text: =Upper(ThisItem.Status)
            Width: =88
            X: =638
            Y: =16
            ZIndex: =4

        Rectangle2_2 As rectangle:
            AccessibleLabel: =ThisItem.Title
            DisabledFill: =Rectangle2_2.Fill
            Fill: =RGBA(202, 202, 202, 1)
            FocusedBorderColor: =Rectangle2_2.BorderColor
            Height: =1.5
            HoverFill: =Rectangle2_2.Fill
            OnSelect: =Select(Parent)
            PressedFill: =Rectangle2_2.Fill
            Width: =Parent.TemplateWidth
            Y: =Parent.TemplateHeight - Rectangle2_2.Height
            ZIndex: =5

    RectNavSep_5 As rectangle:
        DisabledFill: =RectNavSep_5.Fill
        Fill: =RGBA(204, 204, 204, 1)
        FocusedBorderColor: =RectNavSep_5.BorderColor
        Height: =688
        HoverFill: =RectNavSep_5.Fill
        PressedFill: =RectNavSep_5.Fill
        Width: =1
        X: =231
        Y: =80
        ZIndex: =30

    Label1 As label:
        Text: ="Today on leave"
        X: =688
        Y: =316
        ZIndex: =31

